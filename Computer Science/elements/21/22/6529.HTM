<SPAN class=headers>Title:</SPAN></B><SPAN class=RefText> D.2 Processes Details</SPAN></FONT> 
<P></P>
<P><STRONG>The First User Program</STRONG> <SPAN class=extract></P>
<P>All user programs are spawned from other user programs using the exec system call. So how is the &#64257;rst user program created? </P>
<P>Pintos &#20013;&#30340;&#25152;&#26377;&#29992;&#25143;&#31243;&#24207;&#37117;&#26159;&#36890;&#36807;&#20854;&#20182;&#29992;&#25143;&#31243;&#24207;&#25191;&#34892; exec &#25152;&#20135;&#29983;&#30340;</P></SPAN><SPAN class=extract>
<P>When the operating system starts up, it &#64257;rst runs threads/init.c. If the command-line arguments to Pintos indicate that the user wants to start running user programs, the run_task function is called, which has the main thread of Pintos (the one running the threads/init.c code) call process_wait(process_execute(task)). So, the &#64257;rst user program is created by tha main thread of the OS.</P>
<P>&#24403; OS &#21551;&#21160;&#26159;&#65292;&#23427;&#39318;&#20808;&#20250;&#36816;&#34892; threads/init.c&#65292;&#22914;&#26524;&#21629;&#20196;&#34892;&#21442;&#25968;&#34920;&#26126;&#29992;&#25143;&#24819;&#35201;&#21551;&#21160;&#29992;&#25143;&#31243;&#24207;&#65292;&#37027;&#20040; run_task &#20989;&#25968;&#23601;&#20250;&#34987;&#35843;&#29992;&#65292;&#23427;&#20250;&#35753; Pintos &#30340;&#20027;&#32447;&#31243;&#65288;&#20063;&#23601;&#26159;&#21021;&#22987;&#32447;&#31243;&#65289;&#35843;&#29992; process_wait(process_execute(task))</P>
<P></SPAN>&#20063;&#23601;&#26159;&#35828;&#65292;<SPAN class=extract>&#31532;&#19968;&#20010;&#29992;&#25143;&#31243;&#24207;&#26159;&#34987; OS &#30340;&#20027;&#32447;&#31243;&#25152;&#21019;&#24314;&#30340;</SPAN><SPAN class=extract></P>
<P>Quick sidebar: it&#8217;s important to disambiguate between the &#8220;main&#8221; thread of the OS and the main thread of a user program. The main thread of Pintos is the thread that runs threads/init.c &#8211; it is the thread that sets up the OS and starts running the &#64257;rst task, whether that is a user program or a kernel task. The type of task is dependent on the command-line arguments to Pintos. On the other hand, the main thread of a user program is the single thread that is running when that user program is &#64257;rst created. It should be clear from context which &#8220;main&#8221; thread we are referring to.</P>
<P>OS &#30340;&#20027;&#32447;&#31243;&#26159;&#36816;&#34892; threads/init.c &#30340;&#20989;&#25968;&#65292;&#23427;&#26159;&#35774;&#32622; OS &#20197;&#21450;&#21551;&#21160;&#31532;&#19968;&#20010;&#20219;&#21153;&#30340;&#32447;&#31243;&#65292;&#20294;&#26159;&#20855;&#20307;&#21551;&#21160;&#29992;&#25143;&#32447;&#31243;&#36824;&#26159;&#20869;&#26680;&#32447;&#31243;&#21462;&#20915;&#20110;&#21629;&#20196;&#34892;&#21442;&#25968;</P>
<P>&#32780;&#29992;&#25143;&#31243;&#24207;&#30340;&#20027;&#32447;&#31243;&#26159;&#24403;&#29992;&#25143;&#31243;&#24207;&#34987;&#21019;&#24314;&#30340;&#26102;&#20505;&#65292;&#24320;&#22987;&#25191;&#34892;&#30340;&#32447;&#31243;</P>
<P></SPAN><SPAN class=extract>&nbsp;</P>
<P>Because the &#64257;rst user program is created by the OS&#8217;s main thread, the OS&#8217;s main thread must have a PCB, even though it is not a process and will never run user-level code. </P>
<P>OS &#30340;&#20027;&#32447;&#31243;&#24517;&#39035;&#35201;&#26377;&#19968;&#20010; PCB&#65288;&#23613;&#31649;&#23427;&#19981;&#26159;&#36827;&#31243;&#20063;&#27704;&#36828;&#19981;&#20250;&#36816;&#34892;&#29992;&#25143;&#32423;&#20195;&#30721;&#65289;</P>
<P>This is because our implementation of process_wait and process_execute require the parent &#8220;process&#8221; to have access to a list of all child process&#8217; completion statuses. So, in the userprog_init function, we give the OS&#8217;s main thread a (minimal) PCB so that it can successfully execute those functions. Right now, it&#8217;s only possible that the main thread tries to access the children list in those functions. However, if you modify those functions so that the main thread must access another member of struct process, you must initialize that member in userprog_init in userprog/process.c. </P></SPAN><STRONG><SPAN class=extract>
<P><STRONG>PIDs and TIDs</STRONG> In the starter code, we de&#64257;ne the process ID (PID) of a process to be the thread ID (TID) of its main thread. The following two functions in userprog/process.c are related:</P>
<P>&#22312;&#29992;&#25143;&#36827;&#31243;&#30340;&#21551;&#21160;&#20195;&#30721;&#20013;&#65292;&#25105;&#20204;&#23558;&#36827;&#31243; ID &#35774;&#32622;&#20026;&#20854;&#20027;&#32447;&#31243;&#30340; ID</P>
<P>&#8226; bool is_main_thread(struct thread* t, struct process* p)</P>
<P>Returns true if t is the main thread of p</P>
<P>&#8226; pid_t get_pid(struct process* p)</P>
<P>Returns the pid_t of the process p. The pid_t type is the same type as tid_t, which is typedef&#8217;d to be an int.</P>
<P></SPAN></STRONG>