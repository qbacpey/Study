<SPAN class=headers>Title:</SPAN></B><SPAN class=RefText> G.6 Triple Faults</SPAN> 
<P></P>
<P><SPAN class=RefText></SPAN></FONT><SPAN class=extract></P>
<P>When a CPU exception handler, such as a page fault handler, cannot be invoked because it is missing or defective, the CPU will try to invoke the &#8220;double fault&#8221; handler. If the double fault handler is itself missing or defective, that&#8217;s called a &#8220;triple fault.&#8221; A triple fault causes an immediate CPU reset.</P>
<P>&#24403;&#26576;&#20010; CPU &#24322;&#24120;&#22788;&#29702;&#22120;&#20002;&#22833;&#20102;&#25110;&#32773;&#20986;&#29616;&#20102;&#26576;&#20123;&#38169;&#35823;&#65292;&#22240;&#27492;&#19981;&#33021;&#34987;&#35843;&#29992;&#30340;&#26102;&#20505;&#65292;CPU &#23601;&#20250;&#23581;&#35797;&#21435;&#35843;&#29992;&#8220;&#21452;&#35823;&#8221;&#65288;double fault&#65289;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#65292;&#32780;&#22914;&#26524;&#21452;&#35823;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#20063;&#20986;&#20102;&#20160;&#20040;&#38382;&#39064;&#65292;&#37027;&#20040; CPU &#23601;&#20250;&#35843;&#29992;&#8220;&#19977;&#35823;&#8221;&#65288;triple fault&#65289;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#12290;&#19977;&#35823;&#24322;&#24120;&#22788;&#29702;&#31243;&#24207;&#20250;&#30452;&#25509;&#37325;&#21551; CPU</P></SPAN><SPAN class=extract>
<P>Thus, if you get yourself into a situation where the machine reboots in a loop, that&#8217;s probably a &#8220;triple fault.&#8221; In a triple fault situation, you might not be able to use printf for debugging, because the reboots might be happening even before everything needed for printf is initialized.</P>
<P>&#22240;&#27492;&#65292;&#22914;&#26524;&#22312;&#35843;&#35797;&#36807;&#31243;&#20013;&#38519;&#20837;&#20102;&#26576;&#31181;&#37325;&#21551;&#24490;&#29615;&#65292;&#37027;&#22522;&#26412;&#19978;&#23601;&#20195;&#34920;&#20869;&#26680;&#38519;&#20837;&#20102;&#19977;&#35823;&#12290;&#27492;&#22806;&#65292;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#22522;&#26412;&#24456;&#38590;&#20351;&#29992; printf &#36827;&#34892;&#35843;&#35797;&#65292;&#26681;&#26412;&#21407;&#22240;&#26159;&#37325;&#21551;&#21487;&#33021;&#20250;&#21457;&#29983;&#22312; printf &#25152;&#38656;&#35201;&#30340;&#19968;&#20999;&#34987;&#21021;&#22987;&#21270;&#23436;&#25104;&#20043;&#21069;&#24050;&#32463;&#21457;&#29983;&#20102;</P></SPAN><SPAN class=extract>
<P>There are at least two ways to debug triple faults. First, you can run Pintos in Bochs under GDB. If Bochs has been built properly for Pintos, a triple fault under GDB will cause it to print the message &#8220;triple fault: stopping for gdb&#8221; on the console and break into the debugger. (If Bochs is not running under GDB, a triple fault will still cause it to reboot.) You can then inspect where Pintos stopped, which is where the triple fault occurred.</P>
<P>&#31532;&#19968;&#31181;&#35843;&#35797;&#19977;&#35823;&#30340;&#26041;&#27861;&#26159;&#22312; Bochs &#19979;&#36816;&#34892; GDB&#65292;&#22914;&#26524; GDB &#22312;&#36816;&#34892;&#36807;&#31243;&#20013;&#20986;&#29616;&#20102;&#19977;&#35823;&#65292;&#37027;&#20040; GDB &#20250;&#25171;&#21360;&#30456;&#20851;&#30340;&#25552;&#31034;&#20449;&#24687;</P></SPAN><SPAN class=extract>
<P>Another option is &#8220;debugging by in&#64257;nite loop.&#8221; Pick a place in the Pintos code, insert the in&#64257;nite loop <STRONG>for (;;);</STRONG> there, and recompile and run. There are two likely possibilities: The machine hangs without rebooting. If this happens, you know that the in&#64257;nite loop is running. That means that whatever caused the reboot must be after the place you inserted the in&#64257;nite loop. Now move the in&#64257;nite loop later in the code sequence.</P>
<P>&#21478;&#19968;&#20010;&#36873;&#25321;&#26159;&#22312; pintos &#20195;&#30721;&#20013;&#25554;&#20837;&#19968;&#20010;&#26080;&#38480;&#24490;&#29615;&#65288;for(;;);&#65289;&#28982;&#21518;&#20108;&#20998;&#26597;&#25214;&#20986;&#29616;&#38169;&#35823;&#30340;&#22320;&#26041;&#23601;&#34892;&#20102;</P>
<P>The machine reboots in a loop. If this happens, you know that the machine didn&#8217;t make it to the in&#64257;nite loop. Thus, whatever caused the reboot must be before the place you inserted the in&#64257;nite loop. Now move the in&#64257;nite loop earlier in the code sequence.</P>
<P>If you move around the in&#64257;nite loop in a &#8220;binary search&#8221; fashion, you can use this technique to pin down the exact spot that everything goes wrong. It should only take a few minutes at most.<BR></P>
<P></SPAN>