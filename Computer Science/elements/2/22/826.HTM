<P class=caption width=0><B>Figure&nbsp;2.13: </B><SPAN class=extract>A pair of stubs mediates between the user-level caller and the kernel&#8217;s implementation of system calls.</SPAN> <SPAN class=extract>The code is for the file_open system call; other calls have their own stubs.</SPAN> <SPAN class=extract>(1) The user process makes a normal procedure call to a stub linked with the process.</SPAN> (2) <SPAN class=extract>The stub executes the trap instruction.</SPAN> <SPAN class=extract>This transfers control to the kernel trap handler.</SPAN> <SPAN class=extract>The trap handler copies and checks its arguments and then (3) calls a routine to do the operation.</SPAN> <SPAN class=extract>Once the operation completes, (4) the code returns to the trap handler, which copies the return value into user memory and (5) resumes the user stub immediately after the trap.</SPAN> <SPAN class=extract>(6) The user stub returns to the user-level caller.</SPAN>